

#include "..//tm4c123gh6pm.h"
#include "Nokia5110.h"
#include "Random.h"
#include "TExaS.h"

void DisableInterrupts(void); // Disable interrupts
void EnableInterrupts(void); 
void Delay100ms(unsigned long count); // time delay in 0.1 seconds

	int i;
	int f;
	int g;


// *************************** Images ***************************

// enemy ship that starts at the top of the screen (arms/mouth closed)


const unsigned char x[] ={
 0x42, 0x4D, 0xC6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0xC4, 0x0E, 0x00, 0x00, 0xC4, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80,
 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF,
 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
 0x77, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0x77, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x78, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF7, 0x70, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x87,
 0xFF, 0x78, 0xF7, 0x00, 0x00, 0x00, 0x78, 0x00, 0x77, 0x00, 0x87, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x77, 0x00, 0xF7, 0x00, 0x00, 0x00, 0x0F, 0xF8, 0xFF, 0x8F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x77,
 0x77, 0x77, 0x00, 0x00, 0x00, 0x00, 0xFF,

};


const unsigned char king2[] ={
 0x42, 0x4D, 0xC6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0xC4, 0x0E, 0x00, 0x00, 0xC4, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80,
 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF,
 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F,
 0x88, 0x8F, 0xF8, 0x88, 0xF0, 0x00, 0x00, 0x07, 0x88, 0x87, 0x78, 0x88, 0x70, 0x00, 0x00, 0x08, 0xFF, 0xFF, 0xFF, 0xFF, 0x80, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x7F,
 0x70, 0xFF, 0xFF, 0x07, 0xF7, 0x00, 0x07, 0x70, 0x00, 0x7F, 0xF7, 0x00, 0x07, 0x70, 0x00, 0x00, 0x00, 0x07, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,

};




// image of the player's ship
// includes two blacked out columns on the left and right sides of the image to prevent smearing when moved 2 pixels to the left or right
// width=18 x height=8
const unsigned char PlayerShip0[] = {
 0x42, 0x4D, 0xD6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0xC4, 0x0E, 0x00, 0x00, 0xC4, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80,
 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF,
 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0x00, 0x00,
 0x00, 0x00, 0x00, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0x00, 0x00, 0x00, 0x00, 0x00, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0xAA, 0xAA, 0xAA, 0xAA,
 0xAA, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0xAA, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0xAA, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF};

const unsigned char SmallExplosion0[] = {
 0x42, 0x4D, 0xC6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80,
 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF,
 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0,
 0x0F, 0x00, 0x0F, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0x00, 0xF0, 0xF0, 0x0F, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00,
 0xF0, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0xF0, 0xF0, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF};

// a laser burst in flight
// includes one blacked out row on the top and bottom of the image to prevent smearing when moved 1 pixel up or down
// width=2 x height=9
const unsigned char Laser0[] = {
 0x42, 0x4D, 0x9A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80,
 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF,
 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x99, 0x00, 0x00, 0x00, 0xBB, 0x00,
 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF};





unsigned long SW1,SW2,SW3;//initalization the switch 


// port 
void PortF_Init(void){ volatile unsigned long delay;
  SYSCTL_RCGC2_R |= 0x00000020;     // 1) F clock
  delay = SYSCTL_RCGC2_R;           // delay   
  GPIO_PORTF_LOCK_R = 0x4C4F434B;   // 2) unlock PortF PF0  
  GPIO_PORTF_CR_R = 0x1F;           // allow changes to PF4-0       
  GPIO_PORTF_AMSEL_R = 0x00;        // 3) disable analog function
  GPIO_PORTF_PCTL_R = 0x00000000;   // 4) GPIO clear bit PCTL  
  GPIO_PORTF_DIR_R = 0x0E;          // 5) PF4,PF0 input, PF3,PF2,PF1 output   
  GPIO_PORTF_AFSEL_R = 0x00;        // 6) no alternate function
  GPIO_PORTF_PUR_R = 0x11;          // enable pullup resistors on PF4,PF0       
  GPIO_PORTF_DEN_R = 0x1F;          // 7) enable digital pins PF4-PF0        
}

// initalization the characters 
struct State {

  unsigned long x;      // x coordinate

  unsigned long y;      // y coordinate

  const unsigned char *image; // ptr->image

  long life;            // 0=dead, 1=alive

};         

typedef struct State STyp;
STyp black[1];
STyp Enemy[4];
STyp player[1];
STyp gun[1];
STyp king[1];
void Init(void){
king[0].x=0;
		king[0].y= 10;
king[0].image= king2;
king[0].life=1;	
player[0].x=40;
		player[0].y= 45;
	player[0].image= PlayerShip0;
player[0].life=1;	
gun[0].x=player[0].x;
		gun[0].y= player[0].y;
	gun[0].image= Laser0;
gun[0].life=0;
	 black[0].x = 0;

     black[0].y =  25;

   black[0].image =SmallExplosion0;

     black[0].life = 0;

    Enemy[0].x = 0;

    Enemy[0].y = 25;

    Enemy[0].image =  x;

    Enemy[0].life = 1;
	  Enemy[1].x = 20;

    Enemy[1].y = 25;

    Enemy[1].image = x;

    Enemy[1].life = 1;
	  Enemy[2].x = 20*2;

    Enemy[2].y = 25;

    Enemy[2].image = x;

    Enemy[2].life = 1;
		
		  Enemy[3].x = 20*3;

    Enemy[3].y = 25;

    Enemy[3].image = x;

    Enemy[3].life = 1;

   }
// 	calculate  score function
	 int  score( ){
g++;
return g;
}
// gun button function 
void gunMove (void){

	gun[0].life=1;

			if(king[0].x == gun[0].x &&gun[0].y ==king[0].y){
			
			black[0].x=	king[0].x;
				 black[0].y=	king[0].y; 
			 	 black[0].life=1;
		
			king[0].life=0;
			score( );
			
	
			gun[0].life=0;
			gun[0].y	=45;	
			
			}
		if((gun[0].x == 40||gun[0].x == 35||gun[0].x == 45)&&gun[0].y == Enemy[2].y ){
black[0].x=	Enemy[2].x;
				 black[0].y=	Enemy[2].y; 
			 	 black[0].life=1;
		
			Enemy[2].life=0;
			score( );
			
	
			gun[0].life=0;
			gun[0].y	=45;			
		
		}
			 else if((gun[0].x == 60||gun[0].x == 65||gun[0].x == 55)&&gun[0].y == Enemy[3].y ){
			black[0].x=	Enemy[3].x;
				 black[0].y=	Enemy[3].y; 
			 	 black[0].life=1;
			Enemy[3].life=0;
				 score( );
				
			gun[0].life=0;
			gun[0].y	=45;
		}
			  else if((gun[0].x == 20||gun[0].x == 25||gun[0].x == 15)&&gun[0].y == Enemy[1].y ){
black[0].x=	Enemy[1].x;
				 black[0].y=	Enemy[1].y; 
			 	 black[0].life=1;
			Enemy[1].life=0;
					score( );
				
			gun[0].life=0;
						gun[0].y	=45;
		}
		 else if((gun[0].x == 0||gun[0].x==5)&&gun[0].y == Enemy[0].y ){
			black[0].x=	Enemy[0].x;
				 black[0].y=	Enemy[0].y; 
			 	 black[0].life=1;
			Enemy[0].life=0;
			 score( );
	
			 black[0].x=	Enemy[0].x;
				 black[0].y=	Enemy[0].y; 
			 	 black[0].life=1;
			gun[0].life=0;
			 	gun[0].y	=45;
		}
else {		
	  if(gun[0].y > 0){
	gun[0].life=1;
     gun[0].y -= 5;
		

    }
	else{

     gun[0].life = 0; //return the gun to start point 
			gun[0].y	=45;

    }}}
	

//right button function 

void plMoveR (void){
			gun[0].life=0;
	if (player[0].x<72){
		
		player[0].x+=5;// the step 
			gun[0].life=0;
		gun[0].x+=5;
		Delay100ms(1);
		
	}
else {

	player[0].x	=45;	

	gun[0].life=0;// return the gun to start point

gun[0].x	=45;			
		
		
}}

	


// left button function 
void plMoveL (void){
		gun[0].life=0;
	if (player[0].x<72){

		player[0].x-=5;
		gun[0].x-=5;

		
		
	}
	

else {
	player[0].x	=45;
gun[0].life=0;	
	gun[0].x	=45;	
}


}
// draw charachter function 

void Draw(void){ int i;

  Nokia5110_ClearBuffer();

  for(i=0;i<4;i++){

    if(Enemy[i].life > 0){

     Nokia5110_PrintBMP(Enemy[i].x, Enemy[i].y, Enemy[i].image, 0);

    }

  }
		if (king[0].life){
	Nokia5110_PrintBMP(king[0].x, king[0].y, king[0].image, 0);
	}
	if (black[0].life){
	Nokia5110_PrintBMP(black[0].x, black[0].y, black[0].image, 0);
	}
	if( player[0].life>0){
	Nokia5110_PrintBMP(player[0].x, player[0].y, player[0].image, 0);
	
	}
	if( gun[0].life>0){
	Nokia5110_PrintBMP(gun[0].x, gun[0].y, gun[0].image, 0);
	
	}
  Nokia5110_DisplayBuffer();      // draw buffer

}

// function to move the player and gun with the switch
void PLmoving(void){

		  PortF_Init();  

	 EnableInterrupts();

	
    SW1 = GPIO_PORTF_DATA_R&0x10; 
	SW2 = GPIO_PORTF_DATA_R&0x01;
		
	 if((!SW1)&&(!SW2)){
		// both pressed
		gun[0].life=1;
     	 gunMove();
	
		Draw();
		black[0].life=0;
			Draw();
    }
	
		else{                           
      if((!SW1)&&(SW2)){ 
			
				// just SW1 pressed
			
					plMoveR();
		
Draw();
     
      } else{                        
        if((SW1)&&(!SW2)){              // just SW2 pressed
           plMoveL();
		Draw();
				
        }else{// neither switch       
							 player[0].x=32;
		player[0].y= 47;
				 gun[0].life=0;
					
         
        }
				
      }
    }
  }

//start slide function
void start (void){
		    Delay100ms(1);
	Nokia5110_Clear();
	    Delay100ms(1);
		Nokia5110_SetCursor(1,1);
		Nokia5110_OutString("LET'S PLAY");
	    Delay100ms(1);
				Nokia5110_SetCursor(2,3);
		Nokia5110_OutString("ARE YOU");
				Nokia5110_SetCursor(2,5);
		Nokia5110_OutString(" READY ");
	    Delay100ms(1);
	
}
// the last slide function display the score
void word (void){
		    Delay100ms(1);
	Nokia5110_Clear();
	    Delay100ms(1);
		Nokia5110_SetCursor(1,1);
		Nokia5110_OutString("Game Over");
	    Delay100ms(1);
				Nokia5110_SetCursor(1,2);
		Nokia5110_OutString("nice try,");
	    Delay100ms(1);
				Nokia5110_SetCursor(1,3);
		Nokia5110_OutString("The Score ");
	    Delay100ms(1);
				Nokia5110_SetCursor(1,4);

		Nokia5110_OutUDec(g);
	    Delay100ms(1);
}

//enemy move function
void Move(void){ int i;
PLmoving();
	if (king[0].x<72){
	king[0].x+=10;
	}else{
		king[0].x=0;;
	
	}
	
  for(i=0;i<4;i++){

    if(Enemy[i].y < 45){
PLmoving();
      Enemy[i].y += 5;
					Delay100ms(1);

    }else{
PLmoving();
          Enemy[0].x = 0;

    Enemy[0].y = 20;



    Enemy[0].life = 1;
	  Enemy[1].x = 20;

    Enemy[1].y = 20;

   

    Enemy[1].life = 1;
	  Enemy[2].x = 20*2;

    Enemy[2].y = 20;

 

    Enemy[2].life = 1;
		
		  Enemy[3].x = 20*3;

    Enemy[3].y = 20;

  

    Enemy[3].life = 1;

    }

  }
	

}
// function play the game 
void moving(void){
	start();
		Delay100ms(1);
		Draw();	
for(f=0;f<14;f++){

Move();//function to move the enemy and the king 
	Draw();// function to draw the character 
	
}
word();//end slide with the score
}

//the main 
int main(void){
 TExaS_Init(SSI0_Real_Nokia5110_Scope);  // set system clock to 80 MHz

  Nokia5110_Init();

  Nokia5110_ClearBuffer();

  Init();
	
	moving();


 
}




void Delay100ms(unsigned long count){unsigned long volatile time;
  while(count>0){
    time = 95240;  // 0.1sec at 80 MHz
    while(time){
	  	time--;
    }
    count--;
  }
}
